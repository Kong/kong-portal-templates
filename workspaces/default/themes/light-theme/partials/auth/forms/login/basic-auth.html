  <form id="login" data-type="basic-auth">
    <p class="form-error-message toggle-content"></p>

    <label for="email">{{page.locale.login_form_email_label}}</label>
    <input id="email" type="text" name="email" required />

    <label for="password">{{page.locale.login_form_password_label}}</label>
    <input id="password" type="password" name="password" required />

    <button
      id="login-button"
      class="button button-primary"
      type="submit">{{page.locale.login_form_button_text}}</button>
  </form>

  <script type="text/javascript">
    window.addEventListener("load", function () {
      var $FORM = $("#login");
      var $FORM_ERROR = $FORM.find(".form-error-message")

      var API_URL = "http://localhost:8004/{{kong.config.WORKSPACE}}/auth";

      // Determine whether to use Query String value or Default redirect value
      var redirectToDefault = '{{site.auth.redirect_to}}'
      var redirectToQueryValue = getParameterByName('redirectTo')
      var redirectTo = redirectToQueryValue != null
        ? redirectToQueryValue
        : redirectToDefault

      $FORM.submit(function (event) {
        event.preventDefault();

        var fields = {};

        $FORM_ERROR.removeClass('is-visible').html('');
        $FORM.serializeArray().forEach(function (field) {
          fields[field.name] = field.value;
        });

        $.ajax({
          type: 'GET',
          url: API_URL,
          headers: {
            "Authorization": "Basic " + btoa(
              fields.username + ":" + fields.password
            )
          },

          success: function(data) {
            window.location.href = redirectTo;
          },

          error: function (xhr, ajaxOptions, throwError) {
            if (xhr.responseJSON) {
              $FORM_ERROR
                .addClass('is-visible')
                .html(xhr.responseJSON.message);
            }
          }
        });
      })
    })
  </script>
